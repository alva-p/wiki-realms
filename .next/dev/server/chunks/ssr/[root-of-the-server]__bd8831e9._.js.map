{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 14, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Alvaro/Desktop/Proyectos/wiki-realms/components/lastsales/LastSalesClient.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/Desktop/Proyectos/wiki-realms/components/lastsales/LastSalesClient.tsx <module evaluation> from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/Desktop/Proyectos/wiki-realms/components/lastsales/LastSalesClient.tsx <module evaluation>\",\n    \"default\",\n);\n"],"names":[],"mappings":"AAAA,uEAAuE;;;;;AACvE;;uCACe,IAAA,ibAAuB,EAClC;IAAa,MAAM,IAAI,MAAM;AAA0U,GACvW,wGACA","ignoreList":[0]}},
    {"offset": {"line": 28, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Alvaro/Desktop/Proyectos/wiki-realms/components/lastsales/LastSalesClient.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/Desktop/Proyectos/wiki-realms/components/lastsales/LastSalesClient.tsx from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/Desktop/Proyectos/wiki-realms/components/lastsales/LastSalesClient.tsx\",\n    \"default\",\n);\n"],"names":[],"mappings":"AAAA,uEAAuE;;;;;AACvE;;uCACe,IAAA,ibAAuB,EAClC;IAAa,MAAM,IAAI,MAAM;AAAsT,GACnV,oFACA","ignoreList":[0]}},
    {"offset": {"line": 42, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":""}},
    {"offset": {"line": 56, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Alvaro/Desktop/Proyectos/wiki-realms/lib/lastsales.ts"],"sourcesContent":["import fs from 'fs'\r\nimport path from 'path'\r\n\r\nconst DATA_PATH = path.resolve(process.cwd(), 'data', 'lastsales.json')\r\n\r\nexport type Trait = { trait_type: string; value: string }\r\n\r\nexport type Sale = {\r\n  id: string\r\n  collection: string\r\n  tokenId?: string\r\n  price: number\r\n  currency?: string\r\n  date: string\r\n  traits?: Trait[]\r\n}\r\n\r\ntype Stored = {\r\n  last_timestamps: Record<string, number>\r\n  sales: Sale[]\r\n}\r\n\r\nfunction ensureDataFile() {\r\n  const dir = path.dirname(DATA_PATH)\r\n  if (!fs.existsSync(dir)) fs.mkdirSync(dir, { recursive: true })\r\n  if (!fs.existsSync(DATA_PATH)) {\r\n    const initial: Stored = { last_timestamps: {}, sales: [] }\r\n    fs.writeFileSync(DATA_PATH, JSON.stringify(initial, null, 2))\r\n  }\r\n}\r\n\r\nexport function readStored(): Stored {\r\n  ensureDataFile()\r\n  const raw = fs.readFileSync(DATA_PATH, 'utf-8')\r\n  try {\r\n    return JSON.parse(raw) as Stored\r\n  } catch (err) {\r\n    const initial: Stored = { last_timestamps: {}, sales: [] }\r\n    return initial\r\n  }\r\n}\r\n\r\nexport function writeStored(data: Stored) {\r\n  ensureDataFile()\r\n  fs.writeFileSync(DATA_PATH, JSON.stringify(data, null, 2))\r\n}\r\n\r\n/**\r\n * Fetch sales from OpenSea events endpoint and normalize them to Sale[]\r\n */\r\nexport async function fetchOpenSeaSales(contract: string, occurredAfterUnix = 0, apiKey?: string): Promise<Sale[]> {\r\n  if (!contract) return []\r\n  if (!process.env.OPENSEA_API_URL) {\r\n    // default OpenSea events endpoint alternative\r\n    process.env.OPENSEA_API_URL = 'https://api.opensea.io/api/v1/events'\r\n  }\r\n  const base = process.env.OPENSEA_API_URL\r\n  const url = new URL(base)\r\n  // prefer query by collection slug; if contract looks like address, set asset_contract_address\r\n  if (contract && contract.startsWith('0x')) url.searchParams.set('asset_contract_address', contract)\r\n  else url.searchParams.set('collection_slug', contract)\r\n  url.searchParams.set('event_type', 'sale')\r\n  if (occurredAfterUnix) url.searchParams.set('occurred_after', String(occurredAfterUnix))\r\n  url.searchParams.set('limit', '50')\r\n\r\n  const headers: Record<string, string> = {}\r\n  if (apiKey) headers['X-API-KEY'] = apiKey\r\n\r\n  const res = await fetch(url.toString(), { headers })\r\n  if (!res.ok) throw new Error(`OpenSea fetch failed: ${res.status}`)\r\n  const data = await res.json()\r\n\r\n  const events = data?.events || data?.asset_events || []\r\n  const out: Sale[] = events.map((event: any) => {\r\n    const tokenId = event?.nft?.identifier || event?.nft?.token_id || (event?.nft?.tokenId && String(event.nft.tokenId)) || undefined\r\n    const price = event?.payment?.quantity ? Number(event.payment.quantity) / Math.pow(10, 18) : (event?.price ? Number(event.price) : 0)\r\n    const maker = event?.from_account?.address || event?.seller || undefined\r\n    const matcher = event?.to_account?.address || event?.buyer || undefined\r\n    const ts = event?.event_timestamp || event?.created_date || event?.timestamp\r\n    const txHash = event?.transaction_hash || event?.txHash || event?.transaction?.transaction_hash\r\n    const image = event?.nft?.image_url || event?.nft?.image || event?.image\r\n\r\n    return {\r\n      id: String(event.id || txHash || `${contract}-${tokenId}-${ts}`),\r\n      collection: event?.collection?.slug || event?.nft?.collection?.slug || contract,\r\n      tokenId: tokenId != null ? String(tokenId) : undefined,\r\n      price: Number.isFinite(price) ? price : 0,\r\n      currency: event?.payment?.token_symbol || event?.payment?.symbol || event?.payment_token?.symbol || 'ETH',\r\n      date: ts || new Date().toISOString(),\r\n      traits: [],\r\n      // extra fields\r\n      // @ts-ignore\r\n      maker,\r\n      // @ts-ignore\r\n      matcher,\r\n      // @ts-ignore\r\n      txHash,\r\n      // @ts-ignore\r\n      image,\r\n    }\r\n  })\r\n\r\n  return out\r\n}\r\n\r\n/**\r\n * Fetch recent transfer logs from Ronin RPC as a proxy for sales.\r\n * This is a best-effort approach: Ronin doesn't expose a unified \"sales\" REST like OpenSea.\r\n * We scan recent blocks for ERC-721 Transfer events for the contract and return them as Sale[]\r\n */\r\nexport async function fetchRoninSales(contract: string, occurredAfterUnix = 0, rpcUrl?: string): Promise<Sale[]> {\r\n  if (!contract || !rpcUrl) return []\r\n\r\n  // Helper to call JSON-RPC\r\n  async function rpc(method: string, params: any[]) {\r\n    const res = await fetch(rpcUrl!, {\r\n      method: 'POST',\r\n      headers: { 'Content-Type': 'application/json' },\r\n      body: JSON.stringify({ jsonrpc: '2.0', id: 1, method, params }),\r\n    })\r\n    const j = await res.json()\r\n    return j.result\r\n  }\r\n\r\n  // get latest block\r\n  const latestHex = await rpc('eth_blockNumber', [])\r\n  const latest = parseInt(latestHex, 16)\r\n  // scan last N blocks (configurable); 20000 ~ ~ a few days depending on chain\r\n  const SCAN_BLOCKS = 20000\r\n  const fromBlock = Math.max(0, latest - SCAN_BLOCKS)\r\n\r\n  // eth_getLogs params without topics (some providers restrict topics)\r\n  const paramsNoTopic = [{ address: contract, fromBlock: '0x' + fromBlock.toString(16), toBlock: '0x' + latest.toString(16) }]\r\n\r\n  let logs: any[] = []\r\n  try {\r\n    logs = await rpc('eth_getLogs', paramsNoTopic)\r\n  } catch (err) {\r\n    return []\r\n  }\r\n\r\n  const results: Sale[] = []\r\n  for (const log of logs) {\r\n    try {\r\n      if (!log.topics || log.topics.length === 0) continue\r\n      if (!log.topics[0].startsWith('0xddf252ad')) continue // Transfer signature prefix\r\n\r\n      // tokenId usually in topics[3] or in data\r\n      let tokenIdHex = log.topics[3] || log.data\r\n      if (!tokenIdHex) continue\r\n      tokenIdHex = tokenIdHex.startsWith('0x') ? tokenIdHex.slice(2) : tokenIdHex\r\n      tokenIdHex = tokenIdHex.slice(-64)\r\n      const tokenId = BigInt('0x' + tokenIdHex).toString()\r\n\r\n      // get block timestamp\r\n      const block = await rpc('eth_getBlockByNumber', [log.blockNumber, false])\r\n      const ts = block?.timestamp ? parseInt(block.timestamp, 16) : undefined\r\n      if (!ts) continue\r\n      const dateMs = ts * 1000\r\n      if (occurredAfterUnix && ts <= occurredAfterUnix) continue\r\n\r\n      results.push({\r\n        id: `${contract}-${log.transactionHash}-${tokenId}`,\r\n        collection: contract,\r\n        tokenId,\r\n        price: 0,\r\n        currency: 'RONIN',\r\n        date: new Date(dateMs).toISOString(),\r\n        traits: [],\r\n      })\r\n    } catch (e) {\r\n      continue\r\n    }\r\n  }\r\n\r\n  results.sort((a, b) => Date.parse(b.date) - Date.parse(a.date))\r\n  return results\r\n}\r\n\r\n/**\r\n * Fetch recent sales from Ronin GraphQL (mavis marketplace) using the provided query.\r\n * Returns an array of Sale normalized objects.\r\n */\r\nexport async function fetchRoninGraphQLSales(contract: string, apiUrl?: string, apiKey?: string, size = 50, from_ = 0): Promise<Sale[]> {\r\n  if (!contract || !apiUrl) return []\r\n\r\n  const query = `\r\n    query RecentSales($tokenAddress: String!, $from: Int!, $size: Int!) {\r\n      recentlySolds(from: $from, size: $size, tokenAddress: $tokenAddress) {\r\n        results {\r\n          assets {\r\n            token {\r\n              __typename\r\n              ... on Erc1155 {\r\n                tokenIdNum: tokenId\r\n                name\r\n                image\r\n              }\r\n              ... on Erc721 {\r\n                tokenIdStr: tokenId\r\n                name\r\n                image\r\n              }\r\n            }\r\n          }\r\n          maker\r\n          matcher\r\n          realPrice\r\n          timestamp\r\n          txHash\r\n        }\r\n      }\r\n    }\r\n  `\r\n\r\n  const variables = { tokenAddress: contract, from: from_, size }\r\n  const headers: Record<string, string> = { 'Content-Type': 'application/json' }\r\n  if (apiKey) headers['x-api-key'] = apiKey\r\n\r\n  const res = await fetch(apiUrl, { method: 'POST', headers, body: JSON.stringify({ query, variables }) })\r\n  if (!res.ok) {\r\n    const body = await res.text()\r\n    throw new Error(`GraphQL HTTP ${res.status}: ${body}`)\r\n  }\r\n\r\n  const data = await res.json()\r\n  if (data.errors) {\r\n    throw new Error(`GraphQL errors: ${JSON.stringify(data.errors)}`)\r\n  }\r\n\r\n  const items = (data?.data?.recentlySolds?.results) || []\r\n  const out: Sale[] = []\r\n  for (const it of items) {\r\n    try {\r\n      const asset = it?.assets?.[0]\r\n      const token = asset?.token\r\n      const tokenId = token?.tokenIdNum ?? token?.tokenIdStr ?? null\r\n      const txHash = it?.txHash || `${contract}-${tokenId}-${it?.timestamp}`\r\n      const price = it?.realPrice ? Number(it.realPrice) : 0\r\n      const ts = it?.timestamp ? Number(it.timestamp) : undefined\r\n      const date = ts ? (ts > 1e12 ? new Date(ts).toISOString() : new Date(ts * 1000).toISOString()) : new Date().toISOString()\r\n      const image = token?.image || asset?.image || null\r\n      const name = token?.name || null\r\n      const maker = it?.maker || null\r\n      const matcher = it?.matcher || null\r\n      const quantity = asset?.quantity ?? null\r\n\r\n      out.push({\r\n        id: String(txHash),\r\n        collection: contract,\r\n        tokenId: tokenId != null ? String(tokenId) : undefined,\r\n        price,\r\n        currency: 'RONIN',\r\n        date,\r\n        traits: [],\r\n        // attach rawFields to allow UI access to extra fields\r\n        // @ts-ignore\r\n        txHash,\r\n        // @ts-ignore\r\n        maker,\r\n        // @ts-ignore\r\n        matcher,\r\n        // @ts-ignore\r\n        image,\r\n        // @ts-ignore\r\n        name,\r\n        // @ts-ignore\r\n        quantity\r\n      })\r\n    } catch (e) {\r\n      continue\r\n    }\r\n  }\r\n\r\n  return out\r\n}\r\n\r\n/**\r\n * Refresh all configured collections. The COLLECTIONS list should be provided by the caller\r\n * as an array of { name, contract, market, last_timestamp? }.\r\n */\r\nexport async function refreshCollections(collections: { name?: string; contract?: string; market?: string; last_timestamp?: number }[], apiKey?: string) {\r\n  const stored = readStored()\r\n\r\n  for (const col of collections) {\r\n    const key = col.contract || col.name || 'unknown'\r\n    const last = stored.last_timestamps[key] || (col.last_timestamp || 0)\r\n\r\n    try {\r\n      const events = await fetchOpenSeaSales(col.contract || '', last, apiKey)\r\n      if (!events.length) continue\r\n\r\n      // append new events (avoid duplicates by id)\r\n      const existingIds = new Set(stored.sales.map((s) => s.id))\r\n      const toAdd = events.filter((e) => !existingIds.has(e.id))\r\n      stored.sales = [...toAdd, ...stored.sales].slice(0, 5000) // cap\r\n\r\n      // update last timestamp to newest event\r\n      const newest = Math.max(...events.map((e) => Date.parse(e.date) / 1000 || 0))\r\n      stored.last_timestamps[key] = Math.max(stored.last_timestamps[key] || 0, newest)\r\n    } catch (err) {\r\n      // swallow per-collection errors so one failure doesn't stop the whole refresh\r\n      // In production log this properly\r\n      // console.error('refreshCollections error', err)\r\n    }\r\n  }\r\n\r\n  writeStored(stored)\r\n  return stored\r\n}\r\n\r\nexport default {\r\n  readStored,\r\n  writeStored,\r\n  fetchOpenSeaSales,\r\n  refreshCollections,\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 369, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Alvaro/Desktop/Proyectos/wiki-realms/app/lastsales/page.tsx"],"sourcesContent":["import LastSalesClient, { Sale } from '@/components/lastsales/LastSalesClient'\r\nimport {\r\n  fetchOpenSeaSales,\r\n  fetchRoninGraphQLSales,\r\n  fetchRoninSales,\r\n} from '@/lib/lastsales'\r\nimport { readStored } from '@/lib/lastsales'\r\n\r\nconst CONTRACT_KOJINS = process.env.CONTRACT_ADDRESS_KOJINS\r\nconst CONTRACT_MOUNTS = process.env.CONTRACT_ADDRESS_MOUNTS\r\nconst OPENSEA_KEY = process.env.OPENSEA_API_KEY\r\nconst RONIN_API = process.env.RONIN_API_URL\r\nconst RONIN_API_KEY = process.env.API_KEY\r\n\r\nasync function fetchLiveSales(): Promise<Sale[]> {\r\n  const all: Sale[] = []\r\n\r\n  const collections = [\r\n    { name: 'Kojins', contract: CONTRACT_KOJINS },\r\n    { name: 'Mounts', contract: CONTRACT_MOUNTS },\r\n  ]\r\n\r\n  for (const col of collections) {\r\n    if (!col.contract) continue\r\n\r\n    // OpenSea\r\n    try {\r\n      const os = await fetchOpenSeaSales(col.contract, 0, OPENSEA_KEY)\r\n      all.push(...os)\r\n    } catch (e) {\r\n      // ignore\r\n    }\r\n\r\n    // Ronin GraphQL preferred\r\n    try {\r\n      const rg = await fetchRoninGraphQLSales(col.contract, RONIN_API, RONIN_API_KEY)\r\n      if (rg && rg.length) {\r\n        all.push(...rg)\r\n        continue\r\n      }\r\n    } catch (e) {\r\n      // ignore and fallback\r\n    }\r\n\r\n    // Ronin RPC fallback\r\n    try {\r\n      const rr = await fetchRoninSales(col.contract, 0, process.env.RONIN_RPC_URL)\r\n      all.push(...rr)\r\n    } catch (e) {\r\n      // ignore\r\n    }\r\n  }\r\n\r\n  // sort by date desc\r\n  all.sort((a, b) => Date.parse(b.date || '') - Date.parse(a.date || ''))\r\n  return all.slice(0, 500)\r\n}\r\n\r\nexport default async function Page() {\r\n  let sales: Sale[] = []\r\n  try {\r\n    sales = await fetchLiveSales()\r\n  } catch (err) {\r\n    // If live fetch fails, fallback to persisted data (if any) or empty list\r\n    // Log server-side for debugging\r\n    // eslint-disable-next-line no-console\r\n    console.error('fetchLiveSales error', err)\r\n    try {\r\n      const stored = readStored()\r\n      sales = stored.sales || []\r\n    } catch (e) {\r\n      sales = []\r\n    }\r\n  }\r\n\r\n  return (\r\n    <main className=\"container mx-auto py-8\">\r\n      <LastSalesClient sales={sales} />\r\n    </main>\r\n  )\r\n}\r\n\r\n"],"names":[],"mappings":";;;;;AAAA;AACA;;;;;AAOA,MAAM,kBAAkB,QAAQ,GAAG,CAAC,uBAAuB;AAC3D,MAAM,kBAAkB,QAAQ,GAAG,CAAC,uBAAuB;AAC3D,MAAM,cAAc,QAAQ,GAAG,CAAC,eAAe;AAC/C,MAAM,YAAY,QAAQ,GAAG,CAAC,aAAa;AAC3C,MAAM,gBAAgB,QAAQ,GAAG,CAAC,OAAO;AAEzC,eAAe;IACb,MAAM,MAAc,EAAE;IAEtB,MAAM,cAAc;QAClB;YAAE,MAAM;YAAU,UAAU;QAAgB;QAC5C;YAAE,MAAM;YAAU,UAAU;QAAgB;KAC7C;IAED,KAAK,MAAM,OAAO,YAAa;QAC7B,IAAI,CAAC,IAAI,QAAQ,EAAE;QAEnB,UAAU;QACV,IAAI;YACF,MAAM,KAAK,MAAM,IAAA,+KAAiB,EAAC,IAAI,QAAQ,EAAE,GAAG;YACpD,IAAI,IAAI,IAAI;QACd,EAAE,OAAO,GAAG;QACV,SAAS;QACX;QAEA,0BAA0B;QAC1B,IAAI;YACF,MAAM,KAAK,MAAM,IAAA,oLAAsB,EAAC,IAAI,QAAQ,EAAE,WAAW;YACjE,IAAI,MAAM,GAAG,MAAM,EAAE;gBACnB,IAAI,IAAI,IAAI;gBACZ;YACF;QACF,EAAE,OAAO,GAAG;QACV,sBAAsB;QACxB;QAEA,qBAAqB;QACrB,IAAI;YACF,MAAM,KAAK,MAAM,IAAA,6KAAe,EAAC,IAAI,QAAQ,EAAE,GAAG,QAAQ,GAAG,CAAC,aAAa;YAC3E,IAAI,IAAI,IAAI;QACd,EAAE,OAAO,GAAG;QACV,SAAS;QACX;IACF;IAEA,oBAAoB;IACpB,IAAI,IAAI,CAAC,CAAC,GAAG,IAAM,KAAK,KAAK,CAAC,EAAE,IAAI,IAAI,MAAM,KAAK,KAAK,CAAC,EAAE,IAAI,IAAI;IACnE,OAAO,IAAI,KAAK,CAAC,GAAG;AACtB;AAEe,eAAe;IAC5B,IAAI,QAAgB,EAAE;IACtB,IAAI;QACF,QAAQ,MAAM;IAChB,EAAE,OAAO,KAAK;QACZ,yEAAyE;QACzE,gCAAgC;QAChC,sCAAsC;QACtC,QAAQ,KAAK,CAAC,wBAAwB;QACtC,IAAI;YACF,MAAM,SAAS,IAAA,wKAAU;YACzB,QAAQ,OAAO,KAAK,IAAI,EAAE;QAC5B,EAAE,OAAO,GAAG;YACV,QAAQ,EAAE;QACZ;IACF;IAEA,qBACE,uZAAC;QAAK,WAAU;kBACd,cAAA,uZAAC,gMAAe;YAAC,OAAO;;;;;;;;;;;AAG9B"}}]
}